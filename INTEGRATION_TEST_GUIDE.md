# フラクタルエディタ統合テストガイド

## 概要

このドキュメントは、フラクタルエディタの統合テストスイートの使用方法と、テスト結果の解釈について説明します。

## 統合テストスイートの構成

### 1. 基本統合テスト (`test_integration_comprehensive.py`)

#### UI-モデル間統合テスト
- **目的**: UIコンポーネントとデータモデル間の連携を検証
- **テスト内容**:
  - メインウィンドウの初期化
  - フラクタルウィジェットとパラメータパネルの連携
  - フラクタル生成器と色彩システムの統合
  - プロジェクトマネージャーと設定システムの統合

#### エンドツーエンドワークフローテスト
- **目的**: 完全なフラクタル生成ワークフローを検証
- **テスト内容**:
  - フラクタル生成から画像出力までの完全フロー
  - カスタム数式フラクタルのワークフロー
  - プロジェクト保存・読み込みワークフロー

#### パフォーマンス統合テスト
- **目的**: 大規模データ処理時のパフォーマンスを検証
- **テスト内容**:
  - 大画像生成のパフォーマンス（1000x1000ピクセル）
  - 複数フラクタル生成器の連続実行
  - メモリリーク検出

#### エラーハンドリング統合テスト
- **目的**: 異常状況での安定性を検証
- **テスト内容**:
  - 無効なパラメータの処理
  - 数式エラーのハンドリング

### 2. UI応答性統合テスト (`test_ui_responsiveness_integration.py`)

#### UI応答性テスト
- **目的**: 重い計算中でもUIが応答することを検証
- **テスト内容**:
  - 計算中のUI応答性（100ms以内の応答時間）
  - リアルタイムパラメータ更新（1秒以内の更新）
  - バックグラウンド計算のパフォーマンス

#### 並列計算統合テスト
- **目的**: 並列計算機能の正確性とパフォーマンスを検証
- **テスト内容**:
  - 並列計算と逐次計算のパフォーマンス比較
  - 並列計算の精度（複数回実行での一貫性）
  - メモリ効率的な並列計算

#### 進行状況とキャンセレーション機能テスト
- **目的**: 長時間処理の制御機能を検証
- **テスト内容**:
  - 進行状況レポート機能
  - 計算キャンセレーション機能

## テスト実行方法

### 1. 個別テストファイルの実行

```bash
# 基本統合テストの実行
python test_integration_comprehensive.py

# UI応答性テストの実行
python test_ui_responsiveness_integration.py
```

### 2. 統合テストスイート全体の実行

```bash
# 全統合テストの実行（推奨）
python run_integration_tests.py
```

### 3. テスト検証の実行

```bash
# 統合テストの動作確認
python test_integration_verification.py
```

## テスト結果の解釈

### 成功基準

#### パフォーマンステスト
- **大画像生成**: 60秒以内で完了
- **メモリ使用量**: 500MB以内の増加
- **UI応答性**: 平均100ms以内、最大200ms以内
- **リアルタイム更新**: 1秒以内

#### 精度テスト
- **計算結果の一貫性**: 同一パラメータで同一結果
- **数値精度**: NumPyの浮動小数点精度内での一致

#### 安定性テスト
- **エラーハンドリング**: 適切な例外処理とユーザー通知
- **メモリリーク**: 50MB以内のメモリ増加

### 失敗時の対処法

#### パフォーマンス問題
1. **計算時間超過**:
   - システムスペックの確認
   - 並列処理の設定確認
   - メモリ不足の可能性

2. **メモリ使用量過多**:
   - ガベージコレクションの強制実行
   - 大きなデータ構造の最適化
   - メモリリークの調査

#### UI応答性問題
1. **応答時間超過**:
   - バックグラウンド処理の実装確認
   - UIイベントループの最適化
   - 重い処理の分割

2. **更新遅延**:
   - シグナル・スロット接続の確認
   - UI更新頻度の調整

#### 精度・安定性問題
1. **計算結果の不一致**:
   - 浮動小数点演算の精度確認
   - 並列処理での競合状態の調査
   - 初期化処理の確認

2. **例外・エラー**:
   - ログファイルの確認
   - エラーハンドリングの改善
   - 入力検証の強化

## テスト環境要件

### 必須依存関係
- Python 3.8以上
- PyQt6
- NumPy
- Pillow
- psutil

### 推奨システムスペック
- **CPU**: 4コア以上（並列処理テスト用）
- **メモリ**: 8GB以上（大画像生成テスト用）
- **ディスク**: 1GB以上の空き容量（テスト出力用）

### オプション依存関係
- **フォント**: DejaVu Fonts（UI表示改善用）
- **開発ツール**: pytest（追加テスト実行用）

## トラブルシューティング

### よくある問題

#### 1. PyQt6関連エラー
```
QFontDatabase: Cannot find font directory
```
**解決方法**: DejaVu Fontsをインストールするか、フォント設定を調整

#### 2. メモリ関連エラー
```
MemoryError: Unable to allocate array
```
**解決方法**: テストパラメータのサイズを縮小、または物理メモリを増設

#### 3. 並列処理エラー
```
ProcessPoolExecutor: broken process pool
```
**解決方法**: プロセス数を減らす、またはスレッドプールを使用

### ログとデバッグ

#### ログファイルの場所
- `logs/fractal_editor.log`: 一般的なアプリケーションログ
- `logs/errors.log`: エラー専用ログ
- `integration_test_report_*.json`: 統合テスト結果レポート

#### デバッグモードの有効化
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 継続的改善

### テスト追加のガイドライン
1. **新機能追加時**: 対応する統合テストを追加
2. **バグ修正時**: 回帰テストを追加
3. **パフォーマンス改善時**: ベンチマークテストを更新

### テスト品質の維持
- **定期実行**: CI/CDパイプラインでの自動実行
- **カバレッジ測定**: テストカバレッジの監視
- **パフォーマンス監視**: 実行時間の傾向分析

## 参考資料

- [フラクタルエディタ設計文書](design.md)
- [フラクタルエディタ要件文書](requirements.md)
- [PyQt6公式ドキュメント](https://doc.qt.io/qtforpython/)
- [NumPy公式ドキュメント](https://numpy.org/doc/)